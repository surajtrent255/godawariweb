<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport"
	content="width=device-width, initial-scale=1, shrink-to-fit=no" />
<meta name="_csrf" th:content="${_csrf.token}" />
<meta name="_csrf_header" th:content="${_csrf.headerName}">
<title>गोदावरी नगरपालिका, ललितपुर</title>
<link rel="icon" th:href="@{/assets/images/favicon1.ico}"
	href="assets/images/favicon1.ico" type="image/x-icon" />
<link th:href="@{/assets/plugins/vectormap/jquery-jvectormap-2.0.2.css}"
	href="assets/plugins/vectormap/jquery-jvectormap-2.0.2.css"
	rel="stylesheet" />
<link th:href="@{/assets/plugins/simplebar/css/simplebar.css}"
	href="assets/plugins/simplebar/css/simplebar.css" rel="stylesheet" />
<link th:href="@{/assets/css/bootstrap.min.css}"
	href="assets/css/bootstrap.min.css" rel="stylesheet" />
<link th:href="@{/assets/css/animate.css}" href="assets/css/animate.css"
	rel="stylesheet" type="text/css" />
<link th:href="@{/assets/css/icons.css}" href="assets/css/icons.css"
	rel="stylesheet" type="text/css" />
<link th:href="@{/assets/css/sidebar-menu.css}"
	href="assets/css/sidebar-menu.css" rel="stylesheet" />
<link rel="stylesheet"
	th:href="@{/assets/plugins/nepali-datepicker-v2/nepaliDatePickerv2.min.css}"
	href="assets/plugins/nepali-datepicker-v2/nepaliDatePickerv2.min.css">
<link th:href="@{/assets/css/app-style.css}"
	href="assets/css/app-style.css" rel="stylesheet" />
<link rel="stylesheet"
	th:href="@{/assets/plugins/datatable/datatables.min.css}"
	href="assets/plugins/datatable/datatables.min.css">
<link rel="stylesheet"
	th:href="@{/assets/plugins/jquery.steps/css/jquery.steps.css}"
	href="assets/plugins/jquery.steps/css/jquery.steps.css">
<style>
.form-group {
	width: 100%;
}

.wizard>.content {
	background: #fff;
	min-height: 430px;
	margin: 0;
}

.wizard>.content>.body {
	padding: 0;
	width: 100%;
	height: 100%;
}

.member-panel .padding, .member-panel-submit .padding {
	padding: 10px;
}

.wizard>.content>.body label.error {
	margin-left: 0;
}
</style>
<script th:src="@{/assets/js/jquery.min.js}"
	src="assets/js/jquery.min.js"></script>
</head>
<body>
	<div id="wrapper">

		<!--           	Sidebar and header -->
		<div th:replace="~{fragments/private-sidebar :: private-sidebar}"></div>
		<header th:replace="~{fragments/header}" class="header1"> </header>


		<div class="clearfix"></div>
		<div class="content-wrapper">
			<div class="container-fluid" id="pjax-container">
				<div class="row pt-2 pb-2">
					<div class="col-sm-9">
						<h4 class="page-title">Data Management System</h4>
						<ol class="breadcrumb">
							<li class="breadcrumb-item"><a href="javaScript:void();">Home</a></li>
							<li class="breadcrumb-item active" aria-current="page">Add
								Member</li>
						</ol>
					</div>
				</div>
				<div class="card">
					<div class="card-body">
						<div class="card-title">Fill up information about family
							members.</div>
<!-- 						<a href="javascript:void(0)" -->
<!-- 							class="add-member btn btn-primary mb-2" style="margin-left: 8px;">Add -->
<!-- 							Member</a> -->
						<th:form:form method="POST" th:action="@{/resident}"
							modelAttribute="member" enctype="multipart/form-data">


							<!-- 						<form method="POST" action="javascript:void(0)" data-ajax="true" -->
							<!-- 							th:action="@{/resident/add}" -->
							<!-- 							enctype="multipart/form-data"> -->
							<!-- 							<input type="hidden" name="mainId" th:value="${residentFilledId}"> -->
							<!-- 							<input type="hidden" name="_method" value="post"> -->
							<!-- 							<h2>Member 1</h2> -->
							<fieldset>
								<div class="row member-panel" style="display: flex;">


									<!-- 									<div class="col-lg-4 col-md-4 mb-2"> -->
									<!-- 										<div class="padding"> -->
									<!-- 											<label for="household_id"><h4>कित्ता नं :</h4></label> <select -->
									<!-- 												name="household_id[]" id="household_id" -->
									<!-- 												class="form-control required"> -->




									<!-- 											</select> -->
									<!-- 										</div> -->
									<!-- 									</div> -->


									<div class="col-lg-4 col-md-4 mb-2">
										<div class="padding">
											<label for="name"><h4>नाम थर :</h4></label> <input
												type="text" id="name" name="name"
												class="form-control required" value="">
										</div>
									</div>
									<div class="col-lg-4 col-md-4 mb-2">
										<div class="padding">
											<label for="relation"><h4>नाता :</h4></label> <select
												id="relation" name="relation" class="form-control required">
												<option
													th:each="relation, iteration : ${memberFormDetails.relation}"
													th:value="${iteration.index + 1}" th:text="${relation}"></option>
											</select>
										</div>
									</div>
									<div class="col-md-4 col-lg-4 mb-2">
										<div class="padding">
											<label for="gender"><h4>लिङ्ग :</h4></label> <select
												id="gender" name="gender" class="form-control required">
												<option
													th:each="gender, iteration : ${memberFormDetails.gender}"
													th:value="${iteration.index + 1}" th:text="${gender}"></option>
											</select>
										</div>
									</div>
									<div class="col-md-4 col-lg-4 mb-2">
										<div class="padding">
											<label for="age"><h4>उमेर :</h4></label> <input type="text"
												id="ageDisplay" name="ageDisplay" class="form-control age required"
												value="" readonly>
												<input type="hidden" name="age" id="age" value="">
										</div>
									</div>
									<div class="col-lg-4 col-md-4 mb-2">
										<div class="padding">
											<label for="date_of_birth_BS"><h4>जन्म मिति</h4></label><br>
												<label>B.S.</label> <input type="text"
													id="date_of_birth_BS" name="date_of_birth_BS"
													class="form-control required" value="" readonly
													style="width: 50%;">
												<label>A.D.</label><input type="text"
													id="date_of_birth_AD" name="date_of_birth_AD"
													class="form-control required" value="" readonly
													style="width: 50%;">
										</div>
									</div>

									<div class="col-md-4 col-lg-4 mb-2">
										<div class="padding">
											<label><h4>वैवाहिक स्थिति :</h4></label> <select
												name="marital_status" id="marital_status"
												class="form-control required">
												<option
													th:each="maritalStatus, iteration : ${memberFormDetails.maritalStatus}"
													th:value="${iteration.index + 1}"
													th:text="${maritalStatus}"></option>
											</select>
										</div>
									</div>
									<div class="col-md-4 col-lg-4 mb-2">
										<div class="padding">
											<label for="education"><h4>सैक्षिक योग्येता</h4></label> <select
												id="education" name="education"
												class="form-control required">
												<option
													th:each="education, iteration : ${memberFormDetails.education}"
													th:value="${iteration.index + 1}" th:text="${education}"></option>
											</select>
										</div>
									</div>
									<div class="col-md-4 col-lg-4 mb-2">
										<div class="padding">
											<label for="occupation"><h4>पेशा :</h4></label> <input
												type="text" id="occupation" name="occupation"
												class="form-control required" value="">
										</div>
									</div>
									<div class="col-md-4 col-lg-4 mb-2">
										<div class="padding">
											<label><h4>मतदाता परिचयपत्र :</h4></label> <select
												class="form-control required" name="voter_card"
												id="voter_card">
												<option value="1">छ</option>
												<option value="0">छैन</option>
											</select>
										</div>
									</div>
									<div class="col-md-4 col-lg-4 mb-2">
										<div class="padding">
											<label><h4>स्थायी ठेगाना :</h4></label> <select
												class="form-control required" name="migration"
												id="migration">
												<option value="1">स्थायी जन्म</option>
												<option value="2">बसाई सराई</option>
											</select>
										</div>
									</div>
									<div class="col-md-4 col-lg-4 mb-2">
										<div class="padding">
											<label for="health"><h4>स्वास्थ्य अवस्था :</h4></label> <input
												type="text" id="health" name="health"
												class="form-control required" value="">
										</div>
									</div>
								</div>
							</fieldset>
							<!-- 								<input type="submit" value="Submit"/> -->
							<button type="submit"
								class="add-member btn btn-primary mb-2" style="margin-left: 8px;"
								id="member-entry-submit">Add Member</button>
								
						</th:form:form>
					</div>
				</div>
			</div>
		</div>
		<footer th:replace="~{fragments/footer :: footer}"></footer>
	</div>
	<div th:replace="~{fragments/scripts :: scripts}">
	</div>
	<script
		th:src="@{/assets/plugins/nepali-datepicker-v2/nepaliDatePickerv2.min.js}"
		src="assets/plugins/nepali-datepicker-v2/jquery.nepaliDatePickerv2.min.js"></script>
	<script th:inline="javascript">
		/*<![CDATA[*/
		var mainId = /*[[${residentFilledId}]]*/'0';
		/*]]>*/

		$(function() {
			var token = $("meta[name='_csrf']").attr("content");
			var header = $("meta[name='_csrf_header']").attr("content");
			$(document).ajaxSend(function(e, xhr, options) {
				xhr.setRequestHeader(header, token);
			});
		});

		google.load("elements", "1", {
			packages : "transliteration"
		});

		$(function() {
			var options = {
				sourceLanguage : 'en',
				destinationLanguage : [ 'ne' ],
				shortcutKey : 'ctrl+g',
				transliterationEnabled : true
			};
			var control = new google.elements.transliteration.TransliterationControl(
					options);
			var uniElement = $(".unicode input[type='text'], #grid_filter input");
			control.makeTransliteratable(uniElement);
			// control.showControl('translControl');
		});

		function goBack() {
			window.history.back();
		}
		
		$("#date_of_birth_BS")
				.nepaliDatePicker(
						{
							npdMonth : true,
							npdYear : true,
							disableDaysAfter : '1',
							onChange : function() {
								$("#date_of_birth_AD").val(
										BS2AD($("#date_of_birth_BS").val()));

								var diff_ms = Date.now()
										- Date.parse($("#date_of_birth_AD")
												.val());

								var yearString = "";
								var monthString = "";
								var dayString = "";

								var yearValue = Math
										.floor(diff_ms / 31536000000);
								console.log("Years ", yearValue);
								var monthValue = Math
										.floor((diff_ms % 31536000000) / 2592000000);
								console.log("Months ", monthValue);
								var dayValue = Math
										.floor(((diff_ms % 31536000000) % 2592000000) / 86400000);
								console.log("Days ", dayValue);

								if (yearValue > 1)
									yearString = " years";
								else
									yearString = " year";
								if (monthValue > 1)
									monthString = " months";
								else
									monthString = " month";
								if (dayValue > 1)
									dayString = " days";
								else
									dayString = " day";

								if ((yearValue > 0) && (monthValue > 0)
										&& (dayValue > 0))
									var calculatedValue = yearValue
											+ yearString + " " + monthValue
											+ monthString + " " + dayValue
											+ dayString + " ";
								else if ((yearValue > 0) && (monthValue > 0)
										&& (dayValue == 0))
									var calculatedValue = yearValue
											+ yearString + " " + monthValue
											+ monthString + " ";
								else if ((yearValue > 0) && (monthValue == 0)
										&& (dayValue > 0))
									var calculatedValue = yearValue
											+ yearString + " " + dayValue
											+ dayString + " ";
								else if ((yearValue == 0) && (monthValue > 0)
										&& (dayValue > 0))
									var calculatedValue = monthValue
											+ monthString + " " + dayValue
											+ dayString + " ";
								else if ((yearValue == 0) && (monthValue == 0)
										&& (dayValue > 0))
									var calculatedValue = dayValue + dayString
											+ " ";

								$("#age").val(yearValue);
								$("#ageDisplay").val(calculatedValue);
							}
						});

		$(function() {
			$("#member-entry-submit")
					.click(
							function(event) {
								//Getting the data from the formm	
								let memberName = $("#name").val();
								let relation = $("#relation").val();
								let gender = $("#gender").val();
								let age = $("#age").val();
								let dateOfBirthBS = $("#date_of_birth_BS")
										.val();
								let dateOfBirthAD = $("#date_of_birth_AD")
										.val();
								let maritalStatus = $("#marital_status").val();
								let education = $("#education").val();
								let occupation = $("#occupation").val();
								let voterCard = $("#voter_card").val();
								let migration = $("#migration").val();
								let healthStatus = $("#health").val();
								let familyId = mainId;
								let memberInfo = {};
								memberInfo.name = memberName;
								memberInfo.relation = relation;
								memberInfo.gender = gender;
								memberInfo.age = age;
								memberInfo.dateOfBirthBS = dateOfBirthBS;
								memberInfo.dateOfBirthAD = dateOfBirthAD;
								memberInfo.maritalStatus = maritalStatus;
								memberInfo.education = education;
								memberInfo.occupation = occupation;
								memberInfo.voterCard = voterCard;
								memberInfo.address = migration;
								memberInfo.healthCondition = healthStatus;
								memberInfo.mainId = familyId;

								// Now create an ajax request to send member details to the server
								$
										.ajax({
											method : "POST",
											url : contextPath + "/resident/",
											data : JSON.stringify(memberInfo),
											contentType : "Application/Json",
											success : function(result) {
												swal
														.fire(
																{
																	text : result.data,
																	icon : "success",
																	closeOnClickOutside : false,
																	closeOnEsc : false
																})
														.then(
																function() {
																	goBack();
																});
											},
											error : function(error) {
											}
										});
							});
		});
	</script>

</body>
</html>
